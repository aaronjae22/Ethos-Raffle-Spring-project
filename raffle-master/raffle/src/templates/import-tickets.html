<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" layout:decorate="~{layout/main}">

<head>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.js"></script>

</head>

<body>

<div layout:fragment="content">

    <style type="text/css">

        .row-actions
        {
            visibility: hidden;
        }

        .user-row:hover .row-actions
        {
            visibility: visible;
        }

        #periods option { color: black; }
        .empty { color: white; }


    </style>


    <div class="container" id="table-container" th:if="${ loggedUser.administrator }" >

        <div class="row">

            <div class="col-offset-1 col-lg-10">

                <!-- HEADERS AND SELECT FILE BUTTON -->

                <div>
                    <h1 class='pull-left' style="margin-top:0">Import Tickets</h1>

                    <input type="file" name="ticketfile" id="ticketfile" style="display:none;"/>
                    <label for="ticketfile" class="btn btn-primary btn-lg pull-right" style="font-size: 16px; margin-left: 10px">Select file</label>


                    <button type="button" class="btn btn-primary btn-lg pull-right" onclick="tableVisibility()" style="font-size: 16px">Change Sheet</button>

                    <div class="period-dropdown">
                        <select id="periods" class="btn btn-primary btn-lg pull-right" style="font-size: 15px; margin-right: 10px">
                            <option value="0" class="btn btn-primary btn-sm" style="background: white;">Select Period</option>
                            <option value="1" class="btn btn-primary btn-sm" style="background: white; text-align: center">2019</option>
                            <option value="2" class="btn btn-primary btn-sm" style="background: white">2020</option>
                            <option value="3" class="btn btn-primary btn-sm" style="background: white">2021</option>
                            <option value="4" class="btn btn-primary btn-sm" style="background: white">2022</option>
                            <option value="5" class="btn btn-primary btn-sm" style="background: white">2023</option>
                        </select>
                    </div>

                    <button type="button" onclick="uploadFile()" class="btn btn-primary btn-lg pull-right" style="font-size: 16px; margin-right: 10px">Confirm</button>

                </div>

                <div class="ibox float-e-margins">

                    <div class="ibox-content" id="single-ticket-table">
                        <!-- <h1 th:text="${ticketList.size()}"></h1> -->

                        <!-- HEADERS TABLE -->
                        <table class="table">
                            <thead>
                                <tr>
                                    <!-- <th>Id</th> -->
                                    <th>Ticket Number</th>
                                    <th>Product</th>
                                    <th>Period</th>
                                </tr>
                            </thead>

                            <tbody>

                                <!-- <tr th:each="ticket : ${ticketList}">
                                    <td th:text="${ticket.getIdTicketNumbers()}"></td>
                                    <td th:text="${ticket.getIdProduct()}"></td>
                                    <td th:text="${ticket.getIdProduct()}"></td>
                                </tr> -->

                            </tbody>


                        </table>

                    </div>


                    <div class="ibox-content" id="bundle-ticket-table" style="display: none">

                        <!-- HEADERS TABLE -->
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Id</th>
                                    <th>Bundle Number</th>
                                    <th>Ticket Number</th>
                                    <th>Product</th>
                                    <th>Period</th>
                                </tr>
                            </thead>

                        </table>

                    </div>

                </div>
            </div>

        </div>

    </div>


    <!-- NOT ADMINISTRATOR -->
    <div th:if="${ ! loggedUser.administrator }" class="">

        <div class="alert alert-warning">
            <h1> You do not have Administration rights!</h1><br />
            <a href="index.html" th:href="@{/dashboard/home}" class="btn btn-primary m-t">Dashboard</a>
        </div>

    </div>

</div>

<div layout:fragment="footerScripts"  >

    <script src="../../../WebContent/resources/js/app/user-administration.js"			th:src="@{/resources/js/app/user-administration.js?v=1.1}"	></script>

    <script>


        var basePath = '[[@{/}]]';

        initializeEvents(basePath);

        function tableVisibility() {


            if (document.getElementById("single-ticket-table").style.display === "none") {
                document.getElementById("single-ticket-table").style.display = "block";
                document.getElementById("bundle-ticket-table").style.display = "none";
            }
            else {
                document.getElementById("single-ticket-table").style.display = "none";
                document.getElementById("bundle-ticket-table").style.display = "block";
            }
        }

        // Change Period Dropdown styles
        $("#periods").change(function () {
            if($(this).val() == "0") $(this).addClass("empty");
            else $(this).removeClass("empty")
        });
        $("#periods").change();

        // Uploading file selected in input

        /* async function uploadFile() {

            let formData = new FormData();

            formData.append("file", ticketfile.files[0]);

            let response = await fetch('/upload', {
                method: "POST",
                body: formData
            });

            if (response.status == 200) {
                console.log("File successfully uploaded!");
            }

        } */

        function uploadFile() {

            let formData = new FormData();

            // console.log(ticketfile.files[0]);
            console.log("Uploading file previously selected in input");

            const API_ENDPOINT = "/Raffle/upload";
            const request = new XMLHttpRequest();

            request.open("POST", API_ENDPOINT, true);

            request.onreadystatechange = () => {
                if (request.readyState === 4 && request.status === 200) {
                    console.log(request.responseText);
                }
            }

            formData.append("file", ticketfile.files[0]);
            request.send(formData);

        };

        /*  const fileInput = document.getElementById('ticketfile');

        const uploadFile = file => {

            console.log("Uploading file previously selected in input");

            const API_ENDPOINT = "https://file.io";
            const request = new XMLHttpRequest();
            const formData = new FormData();

            request.open("POST", API_ENDPOINT, true);

            request.onreadystatechange = () => {
                if (request.readyState === 4 && request.status === 200) {
                    console.log(request.responseText);
                }
            };

            formData.append("file", file);
            request.send(formData);

        };

        fileInput.addEventListener("change", event => {
            const files = event.target.files;
            console.log(files[0]);
            uploadFile(files[0]);
        }); */


    </script>


</div>

</body>

</html>